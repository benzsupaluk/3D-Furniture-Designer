"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[341],{8341:(e,s,r)=>{r.r(s),r.d(s,{default:()=>x});var t=r(7096),o=r(3764),a=r(3930),i=r(8522),n=r(7315),c=r(501),l=r(6699),h=r(9333),m=r(947),d=r(456);let x=(0,o.memo)(e=>{let{furniture:s,onSelect:r,onMove:x,onScale:u,isSelected:j}=e,[p,g]=(0,o.useState)(!1),[b,w]=(0,o.useState)(!1),S=(0,o.useRef)(null),y=(0,o.useRef)(s.position),M=(0,o.useRef)(null),v=(0,o.useRef)(null),f=(0,o.useRef)([1,1,1]),G=(0,o.useRef)(s.scale||[1,1,1]),L=(0,o.useRef)(null),P=(0,o.useRef)(new a.Zcv(new a.Pq0(0,1,0),0)).current,E=(0,o.useRef)(new a.Pq0).current,{camera:R,gl:C,size:k,raycaster:B,invalidate:D}=(0,i.C)(),{scene:z}=(0,d.N)(),F=z.furniture.filter(e=>e.id!==s.id),I=Math.max(s.dimensions.width,s.dimensions.depth)/2+.2,{scene:N}=((null==s?void 0:s.modelPath)?h.Q.getCachedModel(null==s?void 0:s.modelPath):null)||((null==s?void 0:s.modelPath)?(0,n.p)(s.modelPath):{scene:null});(0,o.useEffect)(()=>{N&&!L.current&&(L.current=N.clone())},[N]);let _=(0,o.useCallback)((e,s)=>{var r;let t=(e-k.left)/k.width*2-1,o=-(2*((s-k.top)/k.height))+1;B.setFromCamera(new a.I9Y(t,o),R);let i=B.ray.intersectPlane(P,E);return null!=(r=null==i?void 0:i.clone())?r:null},[R,B,k]),Y=(0,l.useGesture)({onDragStart:e=>{let{event:s,xy:[r,t]}=e;if(b)return;s.stopPropagation(),g(!0);let o=_(r,t);if(o){var a;M.current=o,v.current=(null==(a=S.current)?void 0:a.position.clone())||null}D()},onDrag:e=>{let{event:r,xy:[t,o],intentional:a}=e;if(!a||!S.current||!M.current||!v.current||!j||b)return;r.stopPropagation();let i=_(t,o);if(i){let e=i.clone().sub(M.current),r=s.dimensions.width/2,t=s.dimensions.depth/2,o=v.current.clone().add(e);o.y=0,o.x=Math.max(-5+r,Math.min(5-r,o.x)),o.z=Math.max(-5+t,Math.min(5-t,o.z));let a=[o.x,o.y,o.z];(0,m.E)(a,s,F)&&(y.current=a,S.current.position.copy(o))}D()},onDragEnd:e=>{let{event:r}=e;r.stopPropagation(),g(!1),M.current=null,v.current=null,x(s,y.current),D()},onClick:e=>{let{event:t}=e;t.stopPropagation(),p||r(s)}},{drag:{filterTaps:!0,threshold:3}}),q=(0,l.useGesture)({onDragStart:e=>{let{event:s,xy:[r,t]}=e;s.stopPropagation(),w(!0);let o=_(r,t);o&&(M.current=o,f.current=[...G.current]),D()},onDrag:e=>{let{event:r,xy:[t,o]}=e;r.stopPropagation();let a=_(t,o);if(!a||!M.current||!S.current)return;let i=(a.x-M.current.x)*.5,n=Math.max(.3,Math.min(3,f.current[0]+i)),c=[n,n,n];(0,m.E)(y.current,{...s,scale:c},F)&&(G.current=c,S.current.scale.set(...c)),D()},onDragEnd:e=>{let{event:r}=e;r.stopPropagation(),w(!1),M.current=null,f.current=[1,1,1],null==u||u(s,y.current,G.current),D()}},{drag:{filterTaps:!0,threshold:.5}});(0,o.useCallback)(()=>({width:s.dimensions.width*G.current[0],height:s.dimensions.height*G.current[1],depth:s.dimensions.depth*G.current[2]}),[s.dimensions,G.current])();let T=(0,o.useRef)(null);return(0,o.useRef)(null),(0,o.useCallback)((e,s)=>{let r=new a.I9Y(e/C.domElement.clientWidth*2-1,-(2*(s/C.domElement.clientHeight))+1);B.setFromCamera(r,R);let t=B.intersectObject(T.current);return t.length>0?t[0].point:null},[R,B,C.domElement]),(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("group",{ref:S,position:[y.current[0],0,y.current[2]],rotation:s.rotation,scale:s.scale,...Y(),children:[(0,t.jsx)(c.E,{position:[0,s.dimensions.height+.5,0],fontSize:.1,name:"label:".concat(s.name),color:"#475467",anchorX:"center",anchorY:"middle",children:s.name},s.name),s.modelPath&&N?(0,t.jsx)("primitive",{castShadow:!0,receiveShadow:!0,object:L.current||N}):(()=>{let{width:e,height:r,depth:o}=s.dimensions,a=s.color;switch(s.type){case"chair":return(0,t.jsxs)("group",{children:[(0,t.jsxs)("mesh",{position:[0,.4*r,0],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[e,.1*r,o]}),(0,t.jsx)("meshLambertMaterial",{color:a})]}),(0,t.jsxs)("mesh",{position:[0,.7*r,-(.35*o)],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[e,.6*r,.1*o]}),(0,t.jsx)("meshLambertMaterial",{color:a})]}),(0,t.jsxs)("mesh",{position:[-e/3,.2*r,-o/3],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[.05,.4*r,.05]}),(0,t.jsx)("meshLambertMaterial",{color:a})]}),(0,t.jsxs)("mesh",{position:[e/3,.2*r,-o/3],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[.05,.4*r,.05]}),(0,t.jsx)("meshLambertMaterial",{color:a})]}),(0,t.jsxs)("mesh",{position:[-e/3,.2*r,o/3],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[.05,.4*r,.05]}),(0,t.jsx)("meshLambertMaterial",{color:a})]}),(0,t.jsxs)("mesh",{position:[e/3,.2*r,o/3],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[.05,.4*r,.05]}),(0,t.jsx)("meshLambertMaterial",{color:a})]})]});case"table":return(0,t.jsxs)("group",{children:[(0,t.jsxs)("mesh",{position:[0,.9*r,0],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[e,.1*r,o]}),(0,t.jsx)("meshLambertMaterial",{color:a})]}),(0,t.jsxs)("mesh",{position:[-(.4*e),.4*r,-(.4*o)],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[.08,.8*r,.08]}),(0,t.jsx)("meshLambertMaterial",{color:a})]}),(0,t.jsxs)("mesh",{position:[.4*e,.4*r,-(.4*o)],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[.08,.8*r,.08]}),(0,t.jsx)("meshLambertMaterial",{color:a})]}),(0,t.jsxs)("mesh",{position:[-(.4*e),.4*r,.4*o],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[.08,.8*r,.08]}),(0,t.jsx)("meshLambertMaterial",{color:a})]}),(0,t.jsxs)("mesh",{position:[.4*e,.4*r,.4*o],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[.08,.8*r,.08]}),(0,t.jsx)("meshLambertMaterial",{color:a})]})]});case"sofa":return(0,t.jsxs)("group",{children:[(0,t.jsxs)("mesh",{position:[0,.5*r,0],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[e,.6*r,o]}),(0,t.jsx)("meshLambertMaterial",{color:a})]}),(0,t.jsxs)("mesh",{position:[0,.8*r,-(.3*o)],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[e,.6*r,.4*o]}),(0,t.jsx)("meshLambertMaterial",{color:a})]}),(0,t.jsxs)("mesh",{position:[-(.4*e),.6*r,0],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[.2*e,.4*r,.8*o]}),(0,t.jsx)("meshLambertMaterial",{color:a})]}),(0,t.jsxs)("mesh",{position:[.4*e,.6*r,0],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[.2*e,.4*r,.8*o]}),(0,t.jsx)("meshLambertMaterial",{color:a})]})]});case"cabinet":return(0,t.jsxs)("group",{children:[(0,t.jsxs)("mesh",{position:[0,r/2,0],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[e,r,o]}),(0,t.jsx)("meshLambertMaterial",{color:a})]}),(0,t.jsxs)("mesh",{position:[-(.25*e),r/2,o/2+.01],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[.45*e,.9*r,.02]}),(0,t.jsx)("meshLambertMaterial",{color:"#d4d4d4"})]}),(0,t.jsxs)("mesh",{position:[.25*e,r/2,o/2+.01],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[.45*e,.9*r,.02]}),(0,t.jsx)("meshLambertMaterial",{color:"#d4d4d4"})]})]});case"bed":return(0,t.jsxs)("group",{children:[(0,t.jsxs)("mesh",{position:[0,.3*r,0],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[e,.3*r,o]}),(0,t.jsx)("meshLambertMaterial",{color:a})]}),(0,t.jsxs)("mesh",{position:[0,.6*r,-o/2+.05],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[e,.6*r,.1]}),(0,t.jsx)("meshLambertMaterial",{color:a})]}),(0,t.jsxs)("mesh",{position:[-e/2+.05,.15*r,-o/2+.05],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[.08,.3*r,.08]}),(0,t.jsx)("meshLambertMaterial",{color:a})]}),(0,t.jsxs)("mesh",{position:[e/2-.05,.15*r,-o/2+.05],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[.08,.3*r,.08]}),(0,t.jsx)("meshLambertMaterial",{color:a})]}),(0,t.jsxs)("mesh",{position:[-e/2+.05,.15*r,o/2-.05],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[.08,.3*r,.08]}),(0,t.jsx)("meshLambertMaterial",{color:a})]}),(0,t.jsxs)("mesh",{position:[e/2-.05,.15*r,o/2-.05],castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[.08,.3*r,.08]}),(0,t.jsx)("meshLambertMaterial",{color:a})]})]});default:return(0,t.jsxs)("mesh",{castShadow:!0,receiveShadow:!0,children:[(0,t.jsx)("boxGeometry",{args:[e,r,o]}),(0,t.jsx)("meshLambertMaterial",{color:a,transparent:!0,opacity:j?.8:1})]})}})(),j&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("spotLight",{position:[0,s.dimensions.height+.7,0],angle:.5,penumbra:.7,intensity:5,distance:6,castShadow:!1,color:"#fffbe6",name:"label:".concat(s.name,"-spotlight")}),(0,t.jsxs)("mesh",{name:"label:".concat(s.name,"-glow-ring"),rotation:[-Math.PI/2,0,0],position:[0,.1,0],children:[(0,t.jsx)("ringGeometry",{args:[1.2*I,1.5*I,32]}),(0,t.jsx)("meshBasicMaterial",{color:"#000000",transparent:!0,opacity:.5})]}),(0,t.jsxs)("mesh",{name:"label:".concat(s.name,"-indicator"),position:[0,s.dimensions.height+1,0],children:[(0,t.jsx)("octahedronGeometry",{args:[.3,0]}),(0,t.jsx)("meshBasicMaterial",{color:"#0543f5",transparent:!0,opacity:.8})]}),(0,t.jsxs)("group",{name:"label:".concat(s.name,"-scale"),position:[1,.4,0],...q(),children:[(0,t.jsxs)("mesh",{children:[(0,t.jsx)("cylinderGeometry",{args:[.04,.04,.5,10]}),(0,t.jsx)("meshBasicMaterial",{color:"#282120"})]}),(0,t.jsxs)("mesh",{position:[0,.3,0],children:[(0,t.jsx)("coneGeometry",{args:[.1,.1,4]}),(0,t.jsx)("meshBasicMaterial",{color:"#282120"})]}),(0,t.jsxs)("mesh",{position:[0,-.3,0],rotation:[Math.PI,0,0],children:[(0,t.jsx)("coneGeometry",{args:[.1,.1,4]}),(0,t.jsx)("meshBasicMaterial",{color:"#282120"})]})]}),b&&(0,t.jsx)("mesh",{name:"label:".concat(s.name,"-scale-indicator"),children:(0,t.jsxs)("lineSegments",{children:[(0,t.jsx)("edgesGeometry",{args:[new a.iNn(s.dimensions.width+.1,s.dimensions.height,s.dimensions.depth+.1)]}),(0,t.jsx)("lineBasicMaterial",{color:"#000000",transparent:!0,opacity:.6})]})})]})]})})})}}]);